@page "/del_pg/{vCompType}"
@page "/del_pg"
@using DigiEquipSys.Interfaces;
@using DigiEquipSys.Models
@using DigiEquipSys.Services
@inject NavigationManager NavigationManager
@inject IAdminService myAdminService
@inject ISessionStorageService sessionStorage
@inject IJSRuntime JSRuntime

<PageTitle>
    Delivery Note
</PageTitle>
<h3 class="page-title">Delivery Note (DN) </h3>

<style>
    .e-grid .e-headercelldiv {
        font-weight: bold !important;
        background-color: #604B7C;
        color: white
    }
</style>
<style>
    .e-spinner-pane .e-spinner-inner .e-spin-Bootstrap4 {
        stroke: red;
    }
</style>
<SfSpinner @bind-Visible="@SpinnerVisible" Type="@SpinnerType.Bootstrap4" Size="50" Label="Data loading">
</SfSpinner>
@if (@Delnotelist != null)
{
    <div class="col-lg-12 Control-section">
        <div class="content-wrapper">
            <div class="row">
                <SfGrid @ref="DelHeadGrid" DataSource="@Delnotelist" Toolbar="Toolbaritems" Height="600" Width="100%" AllowTextWrap="true" AllowFiltering="true" AllowSorting="true" AllowPaging="true" AllowResizing="true" AllowReordering="true" AllowExcelExport="true">
                    <GridFilterSettings Type="Syncfusion.Blazor.Grids.FilterType.CheckBox"></GridFilterSettings>
                    <GridPageSettings PageSize="100" PageSizes="@(new int[] { 50, 100, 200, 400,500})"></GridPageSettings>
                    <GridEvents RowSelected="RowSelectHandler" OnToolbarClick="ToolbarClickHandler" TValue="DelHeadResult"></GridEvents>
                    <GridColumns>
                        <GridColumn Field="@nameof(DelHeadResult.DelId)"
                                HeaderText="Id"
                                IsIdentity="true"
                                IsPrimaryKey="true"
                                Visible="false">
                        </GridColumn>

                        <GridColumn Field="@nameof(DelHeadResult.DelDispNo)"
                                HeaderText="Del No"
                                TextAlign="@TextAlign.Left"
                                Width="30">
                        </GridColumn>
                        <GridColumn Field="@nameof(DelHeadResult.DelApproved)"
                                    HeaderText="Approved"
                                    TextAlign="@TextAlign.Center"
                                    Width="30">
                            <Template>
                                @{
                                    var grn = context as DelHeadResult;
                                    <span style="color: blue; font-weight: bold; font-style:normal; ">
                                        @(grn?.DelApproved == true ? "Yes" : "No")
                                    </span>
                                }
                            </Template>
                        </GridColumn>

                        <GridColumn Field="@nameof(DelHeadResult.DelDate)"
                                HeaderText="Date"
                                Format="d"
                                Type="ColumnType.Date"
                                TextAlign="@TextAlign.Center"
                                Width="30">
                        </GridColumn>

                        <GridForeignColumn Field=@nameof(DelHeadResult.DelClientId)
                                       HeaderText="Client" ForeignKeyField="ClientId"
                                       ForeignKeyValue="ClientName"
                                       ValidationRules="@(new ValidationRules{ Required=true})"
                                       ForeignDataSource="@clientlist" Width="50">
                        </GridForeignColumn>

                        <GridForeignColumn Field=@nameof(DelHeadResult.DelCityId)
                                           HeaderText="City/Place" ForeignKeyField="CityId"
                                           ForeignKeyValue="CityName"
                                           ForeignDataSource="@citylist" Width="30">
                        </GridForeignColumn>

                        <GridColumn Field="@nameof(DelHeadResult.PoNumber)"
                                    HeaderText="Our Ref"
                                    TextAlign="@TextAlign.Left"
                                    Width="20">
                        </GridColumn>
                        <GridColumn Field="@nameof(DelHeadResult.DiffAmt)" Format="n2" Visible="@(myRole == "01")"
                                    HeaderText="Diff Amount"
                                    TextAlign="@TextAlign.Right"
                                    Width="40">
                        </GridColumn>
                        <GridColumn Field="@nameof(DelHeadResult.Margin)" Format="n2" Visible="@(myRole == "01")"
                                    HeaderText="Margin"
                                    TextAlign="@TextAlign.Right"
                                    Width="40">
                        </GridColumn>
                    </GridColumns>
                </SfGrid>
                <WarningPage @ref="Warning" WarningHeaderMessage="@WarningHeaderMessage" WarningContentMessage="@WarningContentMessage" />
                <ConfirmPage @ref="DialogDelete" ConfirmHeaderMessage="@ConfirmHeaderMessage" ConfirmContentMessage="@ConfirmContentMessage" ConfirmationChanged="ConfirmDelete" />
            </div>
        </div>
    </div>
    <div class="e-footer-content">
        <br />
        <div class="col-xs-12 col-sm-12 col-lg-6 col-md-6">
            <a href="#" @onclick="NavigateToPrevious" CssClass="e-link">
                <SfButton CssClass="e-small e-success">BACK</SfButton>
            </a>
        </div>
    </div>
}
