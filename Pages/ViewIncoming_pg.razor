@page "/viewincoming_pg"
@inject HttpClient Http
@using DigiEquipSys.Services
@using DigiEquipSys.Models
@using DigiEquipSys.Interfaces
@inject IvwReceiptService myvwReceiptService
@inject NavigationManager UriHelper
@using System.Dynamic
@inject ISessionStorageService sessionStorage
@inject IJSRuntime JSRuntime

<h3 class="page-title">Incoming Summary</h3>
<style>
    .e-grid .e-headercelldiv {
        font-weight: bold !important;
        background-color: #604B7C;
        color: white
    }

    .e-grid .e-groupheadercell {
        height: 30px;
        background: linear-gradient();
        color: #fff;
    }

        .e-grid .e-groupheadercell:hover {
            height: 30px;
            background: #ffbb60;
            color: #fff;
        }
</style>
<style>
    .e-spinner-pane .e-spinner-inner .e-spin-Bootstrap5 {
        stroke: red;
    }

    .Control-wrapper {
        width: 250px;
    }

    .myButton {
        background-color: #0a0a23;
        color: #fff;
        border: 2px solid #E9E9E9;
        border-width: 2px 2px 2px 2px;
        border-radius: 10px;
        padding: 15px;
        min-height: 30px;
        min-width: 120px;
    }

        .myButton:hover {
            background-color: #002ead;
            transition: 0.7s;
        }

</style>
<SfSpinner @bind-Visible="@SpinnerVisible" Type="@SpinnerType.Bootstrap5" Size="50">
</SfSpinner>

@if (@IncomingList != null)
{
    <div class="col-lg-12 Control-section">
        <div class="content-wrapper">
            <div class="row">
                <div class="Control-wrapper">
                    <SfDateRangePicker TValue="DateTime?" Placeholder="Choose a Date Range" FullScreen="true" ShowClearButton="true">
                        <DateRangePickerEvents TValue="DateTime?" ValueChange="ValueChangeHandler"></DateRangePickerEvents>
                    </SfDateRangePicker>
                </div>
                 <br />
                <div id="container">
                    <SfGrid @ref="IncomingGrid" Height="550px" Width="100%"
                            DataSource="@IncomingList" AllowTextWrap="true"
                            AllowGrouping="true" AllowSorting="true" AllowFiltering="true" AllowPaging="true" AllowResizing="true" AllowReordering="true" AllowExcelExport="true"
                            ContextMenuItems="@(new List<object>() {"AutoFit", "AutoFitAll", "SortAscending", "SortDescending","Copy", "ExcelExport","CsvExport", "FirstPage", "PrevPage","LastPage", "NextPage"})"
                            Toolbar="@(new List<string>() { "Print", "ExcelExport" })">
                        <GridFilterSettings Type="Syncfusion.Blazor.Grids.FilterType.CheckBox"></GridFilterSettings>
                        <GridEditSettings AllowAdding="false" AllowEditing="false" AllowDeleting="false" Mode="EditMode.Normal"></GridEditSettings>
                        <GridEvents TValue="VwReceipt" OnToolbarClick="ToolbarClickHandler"></GridEvents>
                        <GridPageSettings PageSize="20" PageSizes="@(new int[] {20, 30, 50, 100, 200, 400,500})"></GridPageSettings>
                        <GridTemplates>
                            <EmptyRecordTemplate>
                                <span>No Records Found</span>
                            </EmptyRecordTemplate>
                        </GridTemplates>

                        <GridAggregates>
                            <GridAggregate>
                                <GridAggregateColumns>
                                    <GridAggregateColumn Field="RdQty" Type="AggregateType.Sum" Format="n2">
                                        <FooterTemplate Context="vMyContext">
                                            @{
                                                var vMyaggregate = (vMyContext as AggregateTemplateContext);

                                                <div>
                                                    <p>Qty: @vMyaggregate.Sum</p>
                                                </div>
                                            }
                                        </FooterTemplate>
                                    </GridAggregateColumn>

                                    <GridAggregateColumn Field="RdTotal" Type="AggregateType.Sum" Format="n2">
                                        <FooterTemplate Context="vMyContext">
                                            @{
                                                var vMyaggregate = (vMyContext as AggregateTemplateContext);
                                                <div>
                                                    <p>Amt: @vMyaggregate.Sum</p>
                                                </div>
                                            }
                                        </FooterTemplate>
                                    </GridAggregateColumn>


                                </GridAggregateColumns>
                            </GridAggregate>
                        </GridAggregates>

                        <GridColumns>
                            <GridColumn Field="@nameof(VwReceipt.RhDispNo)"
                                        HeaderText="Receipt No."
                                        AllowEditing="false"
                                        Width="30">
                            </GridColumn>

                            <GridColumn Field="@nameof(VwReceipt.RdVendInvDate)" Format="dd/MM/yyyy"
                                        HeaderText="Invoice Date"
                                        AllowEditing="false"
                                        Width="30">
                            </GridColumn>

                            <GridColumn Field="@nameof(VwReceipt.RhDate)" Format="dd/MM/yyyy"
                                        HeaderText="Receipt Date"
                                        AllowEditing="false"
                                        Width="30">
                            </GridColumn>

                            <GridColumn Field="@nameof(VwReceipt.RhApproved)"
                                        HeaderText="Approved"
                                        AllowEditing="false"
                                        Width="30">
                            </GridColumn>

                            <GridColumn Field="@nameof(VwReceipt.RdListNo)"
                                        HeaderText="List No."
                                        AllowEditing="false"
                                        Width="25">
                            </GridColumn>
                            <GridColumn Field="@nameof(VwReceipt.RdLotNo)"
                                        HeaderText="Lot No."
                                        AllowEditing="false"
                                        Width="25">
                            </GridColumn>
                            <GridColumn Field="@nameof(VwReceipt.RdExpiryDate)" Format="dd/MM/yyyy"
                                        HeaderText="Exp. Date"
                                        AllowEditing="false"
                                        Width="30">
                            </GridColumn>

                            <GridColumn Field="@nameof(VwReceipt.ItemDesc)"
                                               HeaderText="Item Desc"
                                               AllowEditing="false"
                                               Width="40">
                            </GridColumn>

                            <GridColumn Field="@nameof(VwReceipt.GrpDesc)"
                                               HeaderText="Group"
                                               AllowEditing="false"
                                               Width="30">
                            </GridColumn>
                            <GridColumn Field="@nameof(VwReceipt.CatDesc)"
                                               HeaderText="Category"
                                               Width="30"
                                               AllowEditing="false">
                            </GridColumn>
                            <GridColumn Field="@nameof(VwReceipt.ItemUnit)"
                                               HeaderText="Unit"
                                               Width="20"
                                               AllowEditing="false">
                            </GridColumn>

                            <GridColumn Field=@nameof(VwReceipt.ClientName)
                                               HeaderText="Client Name" Width="30"
                                               AllowEditing="false">
                            </GridColumn>

                            <GridColumn Field=@nameof(VwReceipt.SuppName)
                                               HeaderText="Supplier Name" Width="30"
                                               AllowEditing="false">
                            </GridColumn>

                            <GridColumn Field="@nameof(VwReceipt.RdUp)" Format="n2" Visible="@IsVisRole"
                                        HeaderText="Purch. Up."
                                        AllowEditing="false"
                                        AllowFiltering=false
                                        TextAlign="TextAlign.Right"
                                        Width="30">
                            </GridColumn>

                            <GridColumn Field="@nameof(VwReceipt.RdQty)"
                                        HeaderText="Purch. Qty"
                                        AllowEditing="false"
                                        AllowFiltering=false
                                        TextAlign="TextAlign.Right"
                                        Width="30">
                            </GridColumn>

                            <GridColumn Field="@nameof(VwReceipt.RdTotal)" Format="n2" Visible="@IsVisRole"
                                        HeaderText="Purch. Amt"
                                        AllowEditing="false"
                                        AllowFiltering=false
                                        TextAlign="TextAlign.Right"
                                        Width="30">
                            </GridColumn>
                        </GridColumns>
                    </SfGrid>
                </div>
                <br />
            </div>
            <WarningPage @ref="Warning" WarningHeaderMessage="@WarningHeaderMessage" WarningContentMessage="@WarningContentMessage" />
            <a href="#" @onclick="NavigateToPrevious" CssClass="e-link">
                <SfButton CssClass="e-small e-success">BACK</SfButton>
            </a>
            <span style="font-weight:600;text-align:right;">Total Quantities: @TotalQty </span>
            <span style="font-weight:600;text-align:right;visibility:@(IsVisRole ? "visible" : "hidden")">Total Amount: @TotalAmt.ToString("N2") </span>
        </div>
    </div>
}